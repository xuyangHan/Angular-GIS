(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{NloG:function(e,t,i){"use strict";var s=i("pO5D"),a=(i("wSAH"),i("6S2I")),n=(i("zqDF"),i("WbKI")),r=i("04ZG"),l=(i("4EHJ"),i("ju1D"),i("9AIY"),i("/CmD")),o=i("zm0L"),h=i("pdg3"),c=i("+rMe"),p=i("kJYu");let d=class extends(Object(p.b)(Object(h.a)(Object(c.b)(o.a.EventedMixin(l.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw a.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(s.a)([Object(n.b)()],d.prototype,"fullOpacity",null),Object(s.a)([Object(n.b)()],d.prototype,"layer",void 0),Object(s.a)([Object(n.b)()],d.prototype,"parent",void 0),Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"suspended",null),Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"suspendInfo",null),Object(s.a)([Object(n.b)({readOnly:!0})],d.prototype,"legendEnabled",null),Object(s.a)([Object(n.b)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),Object(s.a)([Object(n.b)()],d.prototype,"visible",null),d=Object(s.a)([Object(r.a)("esri.views.layers.LayerView")],d),t.a=d},QmHG:function(e,t,i){"use strict";i.d(t,"a",function(){return m}),i.d(t,"b",function(){return a}),i.d(t,"c",function(){return u}),i.d(t,"d",function(){return g}),i.d(t,"e",function(){return r}),i.d(t,"f",function(){return o}),i.d(t,"g",function(){return l}),i.d(t,"h",function(){return b}),i.d(t,"i",function(){return n}),i.d(t,"j",function(){return d}),i.d(t,"k",function(){return p}),i.d(t,"l",function(){return c}),i.d(t,"m",function(){return h});var s=i("srIe");function a(e=w){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function n(e,t,i,s,n,r,l=a()){return l[0]=e,l[1]=t,l[2]=i,l[3]=s,l[4]=n,l[5]=r,l}function r(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function l(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function o(e,t,i){const s=t.length;let a=e[0],n=e[1],r=e[2],l=e[3],o=e[4],h=e[5];if(i)for(let c=0;c<s;c++){const e=t[c];a=Math.min(a,e[0]),n=Math.min(n,e[1]),r=Math.min(r,e[2]),l=Math.max(l,e[0]),o=Math.max(o,e[1]),h=Math.max(h,e[2])}else for(let c=0;c<s;c++){const e=t[c];a=Math.min(a,e[0]),n=Math.min(n,e[1]),l=Math.max(l,e[0]),o=Math.max(o,e[1])}e[0]=a,e[1]=n,e[2]=r,e[3]=l,e[4]=o,e[5]=h}function h(e,t=[0,0,0]){return t[0]=function(e){return e[0]>=e[3]?0:e[3]-e[0]}(e),t[1]=function(e){return e[1]>=e[4]?0:e[4]-e[1]}(e),t[2]=function(e){return e[2]>=e[5]?0:e[5]-e[2]}(e),t}function c(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function p(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function u(e){return e?d(e,m):a(m)}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function y(e){return 6===e.length}function g(e,t,i){if(Object(s.h)(e)||Object(s.h)(t))return e===t;if(!y(e)||!y(t))return!1;if(i){for(let s=0;s<e.length;s++)if(!i(e[s],t[s]))return!1}else for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}i("OvF4"),i("kYAx");const m=[1/0,1/0,1/0,-1/0,-1/0,-1/0],w=[0,0,0,0,0,0];a()},Vm2Q:function(e,t,i){"use strict";i.d(t,"a",function(){return S});var s=i("pO5D"),a=(i("wSAH"),i("6S2I"),i("zqDF"),i("WbKI")),n=i("04ZG"),r=(i("4EHJ"),i("ju1D"),i("9AIY"),i("LE9a")),l=i("fX31"),o=i("N5XI"),h=i("ag7Y");let c=class extends h.a{};c=Object(s.a)([Object(n.a)("esri.views.layers.support.ClipArea")],c);var p,d=c;let u=p=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new p({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],u.prototype,"left",void 0),Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],u.prototype,"right",void 0),Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],u.prototype,"top",void 0),Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],u.prototype,"bottom",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],u.prototype,"version",null),u=p=Object(s.a)([Object(n.a)("esri.views.layers.support.ClipRect")],u);var b,y=u,g=i("AMBt"),m=i("N2DF"),w=i("OvF4"),v=i("Ehki"),O=i("qatw");i("4GrV");const f={base:m.a,key:"type",typeMap:{extent:w.a,polygon:v.a}};let j=b=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new b({geometry:this.geometry.clone()})}};Object(s.a)([Object(a.b)({types:f,json:{read:O.a,write:!0}})],j.prototype,"geometry",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],j.prototype,"version",null),j=b=Object(s.a)([Object(n.a)("esri.views.layers.support.Geometry")],j);var _=j;let V=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(s.a)([Object(a.b)({type:[[[Number]]],json:{write:!0}})],V.prototype,"path",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],V.prototype,"version",null),V=Object(s.a)([Object(n.a)("esri.views.layers.support.Path")],V);const I=r.a.ofType({key:"type",base:d,typeMap:{rect:y,path:V,geometry:_}}),S=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new I,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new g.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(o.a)(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(o.a)(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(o.a)(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(o.a)(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const i=this.layer,s=i.minScale,a=i.maxScale;if(null!=s&&null!=a){let i=!s,n=!a;!i&&e<=s&&(i=!0),!n&&e>=a&&(n=!0),t=i&&n}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(s.a)([Object(a.b)({type:I,set(e){const t=Object(l.b)(e,this._get("clips"),I);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(s.a)([Object(a.b)()],t.prototype,"moving",void 0),Object(s.a)([Object(a.b)()],t.prototype,"attached",void 0),Object(s.a)([Object(a.b)()],t.prototype,"container",void 0),Object(s.a)([Object(a.b)()],t.prototype,"suspended",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(s.a)([Object(a.b)()],t.prototype,"updateRequested",void 0),Object(s.a)([Object(a.b)()],t.prototype,"updating",null),Object(s.a)([Object(a.b)()],t.prototype,"view",void 0),t=Object(s.a)([Object(n.a)("esri.views.2d.layers.LayerView2D")],t),t}},oM7z:function(e,t,i){"use strict";i.r(t);var s=i("pO5D"),a=(i("wSAH"),i("srIe")),n=(i("6S2I"),i("zqDF"),i("WbKI")),r=i("04ZG"),l=i("4EHJ"),o=(i("ju1D"),i("9AIY"),i("WZb1")),h=i("l4ZG"),c=i("OvF4"),p=i("LE9a"),d=i("975N"),u=i("Lqtk"),b=i("r0DZ"),y=i("gYg2"),g=i("u3Ia"),m=i("9iar"),w=i("BGvB"),v=i("NloG"),O=i("Vh9r"),f=i("q03O"),j=i("xzrc"),_=i("LTnl"),V=i("Vm2Q");class I{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let S=class extends(Object(V.a)(v.a)){constructor(){super(...arguments),this._handles=new b.a,this._bitmapIndex=new Map,this._mapImageContainer=new _.a,this._kmlVisualData=new I,this.allVisiblePoints=new m.a,this.allVisiblePolylines=new m.a,this.allVisiblePolygons=new m.a,this.allVisibleMapImages=new p.a}hitTest(e,t){if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return Promise.resolve(null);const i=[this._pointsView.hitTest(e,t),this._polylinesView.hitTest(e,t),this._polygonsView.hitTest(e,t)];return Promise.all(i).then(e=>e.filter(e=>(e&&(e.layer=this.layer,e.sourceLayer=this.layer),!!e))[0]||null)}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._handles.add([this.allVisibleMapImages.on("change",e=>{e.added.forEach(e=>this._addMapImage(e)),e.removed.forEach(e=>this._removeMapImage(e))})]),this.container.addChild(this._mapImageContainer),this._polygonsView=new O.a({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new f.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new O.a({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new f.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new O.a({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new f.a(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.watch("layer.visibleSublayers",e=>{for(const[t,i]of this._kmlVisualData.allSublayers)i.visibility=0;for(const t of e){const e=this._kmlVisualData.allSublayers.get(t.id);e&&(e.visibility=1)}this._refreshCollections()}),this._fetchingPromise=this._fetchService().then(()=>{this._fetchingPromise=null,this.notifyChange("updating")})}detach(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&Object(u.default)(e.href,{responseType:"image"}).then(({data:t})=>{let i=c.a.fromJSON(e.extent);Object(h.a)(i,this.view.spatialReference)&&(i=Object(h.d)(i,this.view.spatialReference));const s=new j.a(t,"standard");s.x=i.xmin,s.y=i.ymax,s.resolution=i.width/t.naturalWidth,s.rotation=e.rotation,this._mapImageContainer.addChild(s),this._bitmapIndex.set(e,s)})}async _getViewDependentUrl(e,t){const{viewFormat:i,viewBoundScale:s,httpQuery:n}=e;if(Object(a.i)(i)){if(Object(a.h)(t))throw new Error("Loading this network link requires a view state.");let r;if(await Object(y.f)(),Object(a.i)(s)&&1!==s){const e=new c.a(t.extent);e.expand(s),r=e}else r=t.extent;r=Object(y.g)(r,o.a.WGS84);const h=Object(y.g)(r,o.a.WebMercator),p=r.xmin,u=r.xmax,b=r.ymin,m=r.ymax,w=t.size[0]*t.pixelRatio,v=t.size[1]*t.pixelRatio,O=Math.max(h.width,h.height),f={"[bboxWest]":p.toString(),"[bboxEast]":u.toString(),"[bboxSouth]":b.toString(),"[bboxNorth]":m.toString(),"[lookatLon]":r.center.x.toString(),"[lookatLat]":r.center.y.toString(),"[lookatRange]":O.toString(),"[lookatTilt]":"0","[lookatHeading]":t.rotation.toString(),"[lookatTerrainLon]":r.center.x.toString(),"[lookatTerrainLat]":r.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":r.center.x.toString(),"[cameraLat]":r.center.y.toString(),"[cameraAlt]":O.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":w.toString(),"[vertPixels]":v.toString(),"[terrainEnabled]":"0","[clientVersion]":d.d,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},j=e=>{for(const t in e)for(const i in f)e[t]=e[t].replace(i,f[i])},_=Object(l.E)(i);j(_);let V={};Object(a.i)(n)&&(V=Object(l.E)(n),j(V));const I=Object(g.c)(e.href);return I.query={...I.query,..._,...V},`${I.path}?${Object(l.D)(_)}`}return e.href}async _fetchService(){const e=new I;await this._loadVisualData(this.layer.url,e),this._kmlVisualData=e,this._refreshCollections()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e)),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e)),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e)),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter(e=>this._isSublayerVisible(e.sublayerId)).map(({item:e})=>e))}_isSublayerVisible(e){const t=this._kmlVisualData.allSublayers.get(e);return!!t.visibility&&(-1===t.parentFolderId||this._isSublayerVisible(t.parentFolderId))}_loadVisualData(e,t){return this._fetchParsedKML(e).then(async e=>{for(const i of e.sublayers){t.allSublayers.set(i.id,i);const e=i.points?await Object(w.c)(i.points):[],s=i.polylines?await Object(w.c)(i.polylines):[],a=i.polygons?await Object(w.c)(i.polygons):[],n=i.mapImages||[];if(t.allPoints.push(...e.map(e=>({item:e,sublayerId:i.id}))),t.allPolylines.push(...s.map(e=>({item:e,sublayerId:i.id}))),t.allPolygons.push(...a.map(e=>({item:e,sublayerId:i.id}))),t.allMapImages.push(...n.map(e=>({item:e,sublayerId:i.id}))),i.networkLink){const e=await this._getViewDependentUrl(i.networkLink,this.view.state);await this._loadVisualData(e,t)}}})}_fetchParsedKML(e){return Object(w.b)(e,this.view.spatialReference,this.layer.refreshInterval).then(e=>Object(w.d)(e.data))}_removeMapImage(e){const t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))}};Object(s.a)([Object(n.b)()],S.prototype,"_pointsView",void 0),Object(s.a)([Object(n.b)()],S.prototype,"_polylinesView",void 0),Object(s.a)([Object(n.b)()],S.prototype,"_polygonsView",void 0),Object(s.a)([Object(n.b)()],S.prototype,"_fetchingPromise",void 0),Object(s.a)([Object(n.b)()],S.prototype,"updating",void 0),S=Object(s.a)([Object(r.a)("esri.views.2d.layers.KMLLayerView2D")],S),t.default=S}}]);