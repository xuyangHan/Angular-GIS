{"version":3,"sources":["./node_modules/@arcgis/core/layers/support/LercDecoder.js","./node_modules/@arcgis/core/layers/ElevationLayer.js","./node_modules/@arcgis/core/core/workers/WorkerHandle.js"],"names":[],"mappings":"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","file":"ElevationLayer-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{WorkerHandle as e}from\"../../core/workers/WorkerHandle.js\";class r extends e{constructor(e){super(\"LercWorker\",\"_decode\",e,{strategy:\"dedicated\"}),this.scheduler=e}decode(e,r,t){return e&&0!==e.byteLength?this.invoke({buffer:e,options:r},t):Promise.resolve(null)}getTransferList(e){return[e.buffer]}}const t=new Map;function n(e){let n=t.get(e);return n||(n={instance:new r(e),ref:0},t.set(e,n)),++n.ref,n.instance}function s(e){if(null==e)return;const r=e.scheduler,n=t.get(r);n&&--n.ref<=0&&(n.instance.destroy(),t.delete(r))}export{n as acquireDecoder,s as releaseDecoder};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{isSome as r}from\"../core/maybe.js\";import t from\"../core/Logger.js\";import\"../core/accessorSupport/ensureType.js\";import{property as o}from\"../core/accessorSupport/decorators/property.js\";import{reader as i}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as s}from\"../core/accessorSupport/decorators/subclass.js\";import a from\"../core/Error.js\";import{objectToQuery as l}from\"../core/urlUtils.js\";import\"../core/uuid.js\";import\"../portal/support/resourceExtension.js\";import{createAbortController as n,throwIfAborted as p}from\"../core/promiseUtils.js\";import c from\"../request.js\";import m from\"./Layer.js\";import{MultiOriginJSONMixin as u}from\"../core/MultiOriginJSONSupport.js\";import d from\"../geometry/HeightModelInfo.js\";import{url as h}from\"./support/commonProperties.js\";import{OperationalLayer as y}from\"./mixins/OperationalLayer.js\";import{ArcGISService as v}from\"./mixins/ArcGISService.js\";import{PortalLayer as g}from\"./mixins/PortalLayer.js\";import{ArcGISCachedService as f}from\"./mixins/ArcGISCachedService.js\";import{acquireDecoder as S,releaseDecoder as j}from\"./support/LercDecoder.js\";const w=t.getLogger(\"esri.layers.ElevationLayer\");let x=class extends(f(v(y(g(u(m)))))){constructor(...e){super(...e),this.copyright=null,this.heightModelInfo=null,this.path=null,this.opacity=1,this.operationalLayerType=\"ArcGISTiledElevationServiceLayer\",this.sourceJSON=null,this.type=\"elevation\",this.url=null,this.version=null,this._lercDecoder=S()}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}destroy(){j(this._lercDecoder),this._lercDecoder=null}set minScale(e){this.constructed&&w.warn(`${this.declaredClass}.minScale support has been removed (since 4.5)`)}get minScale(){}set maxScale(e){this.constructed&&w.warn(`${this.declaredClass}.maxScale support has been removed (since 4.5)`)}get maxScale(){}readVersion(e,r){let t=r.currentVersion;return t||(t=9.3),t}load(e){const t=r(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Image Service\"],supportsData:!1,validateItem:e=>{for(let r=0;r<e.typeKeywords.length;r++)if(\"elevation 3d layer\"===e.typeKeywords[r].toLowerCase())return!0;throw new a(\"portal:invalid-layer-item-type\",\"Invalid layer item type '${type}', expected '${expectedType}' \",{type:\"Image Service\",expectedType:\"Image Service Elevation 3D Layer\"})}},e).then((()=>this._fetchImageService(t)),(()=>this._fetchImageService(t)))),Promise.resolve(this)}fetchTile(e,t,o,i){const s=r((i=i||{signal:null}).signal)?i.signal:i.signal=n().signal,a={responseType:\"array-buffer\",signal:s},l={noDataValue:i.noDataValue,returnFileInfo:!0};return this.load().then((()=>this._fetchTileAvailability(e,t,o,i))).then((()=>c(this.getTileUrl(e,t,o),a))).then((e=>this._lercDecoder.decode(e.data,l,s))).then((e=>({values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue})))}getTileUrl(e,r,t){const o=!this.tilemapCache&&this.supportsBlankTile,i=l({...this.parsedUrl.query,blankTile:!o&&null});return`${this.parsedUrl.path}/tile/${e}/${r}/${t}${i?\"?\"+i:\"\"}`}async queryElevation(e,r){const{ElevationQuery:t}=await import(\"./support/ElevationQuery.js\");p(r);return(new t).query(this,e,r)}async createElevationSampler(e,r){const{ElevationQuery:t}=await import(\"./support/ElevationQuery.js\");p(r);return(new t).createSampler(this,e,r)}_fetchTileAvailability(e,r,t,o){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,r,t,o):Promise.resolve(\"unknown\")}async _fetchImageService(e){if(this.sourceJSON)return this.sourceJSON;const r={query:{f:\"json\",...this.parsedUrl.query},responseType:\"json\",signal:e},t=await c(this.parsedUrl.path,r);t.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=t.data,this.read(t.data,{origin:\"service\",url:this.parsedUrl})}};e([o({json:{read:{source:\"copyrightText\"}}})],x.prototype,\"copyright\",void 0),e([o({readOnly:!0,type:d})],x.prototype,\"heightModelInfo\",void 0),e([o({type:String,json:{origins:{\"web-scene\":{read:!0,write:!0}},read:!1}})],x.prototype,\"path\",void 0),e([o({type:[\"show\",\"hide\"]})],x.prototype,\"listMode\",void 0),e([o({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},\"portal-item\":{read:!1,write:!1},\"web-document\":{read:!1,write:!1}}}})],x.prototype,\"minScale\",null),e([o({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},\"portal-item\":{read:!1,write:!1},\"web-document\":{read:!1,write:!1}}}})],x.prototype,\"maxScale\",null),e([o({json:{read:!1,write:!1,origins:{\"web-document\":{read:!1,write:!1}}}})],x.prototype,\"opacity\",void 0),e([o({type:[\"ArcGISTiledElevationServiceLayer\"]})],x.prototype,\"operationalLayerType\",void 0),e([o()],x.prototype,\"sourceJSON\",void 0),e([o({json:{read:!1},value:\"elevation\",readOnly:!0})],x.prototype,\"type\",void 0),e([o(h)],x.prototype,\"url\",void 0),e([o()],x.prototype,\"version\",void 0),e([i(\"version\",[\"currentVersion\"])],x.prototype,\"readVersion\",null),x=e([s(\"esri.layers.ElevationLayer\")],x);var T=x;export default T;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../maybe.js\";import t from\"../Logger.js\";import{makeHandle as r}from\"../handleUtils.js\";import{remove as s}from\"../arrayUtils.js\";import{throwIfAborted as i}from\"../promiseUtils.js\";import{open as o}from\"./workers.js\";const h=t.getLogger(\"esri.core.workers.WorkerHandle\");class n{constructor(e,t,r,s={}){this._mainMethod=t,this._listeners=[],this._promise=o(e,{...s,scheduler:r}).then((e=>{if(void 0===this._thread){this._thread=e,this._promise=null,s.hasInitialize&&this.broadcast({},\"initialize\");for(const e of this._listeners)this._connectListener(e)}else e.close()})),this._promise.catch((t=>h.error(`Failed to initialize ${e} worker: ${t}`)))}on(t,i){const o={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(o),this._connectListener(o),r((()=>{o.removed=!0,s(this._listeners,o),this._thread&&e(o.threadHandle)&&o.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(e,t){return this.invokeMethod(this._mainMethod,e,t)}invokeMethod(e,t,r){if(this._thread){const s=this.getTransferList(t,e);return this._thread.invoke(e,t,{transferList:s,signal:r})}return this._promise?this._promise.then((()=>(i(r),this.invokeMethod(e,t,r)))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(e,t))):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then((t=>{e.removed||(e.threadHandle=t)}))}}export{n as WorkerHandle};\n"],"sourceRoot":"webpack:///"}