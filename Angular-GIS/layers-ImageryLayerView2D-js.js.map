{"version":3,"sources":["./node_modules/@arcgis/core/layers/support/rasterFunctions/vectorFieldUtils.js","./node_modules/@arcgis/core/views/2d/layers/imagery/ImageryGraphicsView2D.js","./node_modules/@arcgis/core/views/2d/layers/ImageryLayerView2D.js","./node_modules/@arcgis/core/views/layers/support/popupUtils.js","./node_modules/@arcgis/core/views/2d/layers/imagery/ImageryView2D.js","./node_modules/@arcgis/core/layers/support/rasterFunctions/rasterProjectionHelper.js","./node_modules/@arcgis/core/views/layers/ImageryLayerView.js"],"names":[],"mappings":"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","file":"layers-ImageryLayerView2D-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import t from\"../PixelBlock.js\";const i=180/Math.PI,n=function(e){return e&&\"esri.layers.support.PixelBlock\"===e.declaredClass&&e.pixels&&e.pixels.length>0},r=new Map;function a(e,t){return r.get(e)/r.get(t)||1}function o(e){return(450-e)%360}function h(e,t=\"geographic\"){const[n,r]=e,a=Math.sqrt(n*n+r*r);let h=Math.atan2(r,n)*i;return h=(360+h)%360,\"geographic\"===t&&(h=o(h)),[a,h]}function s(e,t=\"geographic\"){let n=e[1];\"geographic\"===t&&(n=o(n)),n%=360;const r=e[0];return[r*Math.cos(n/i),r*Math.sin(n/i)]}function l(e,i,r=\"geographic\",a=1){if(!n(e))return e;const{pixels:o,width:l,height:c}=e,p=l*c,u=o[0],x=o[1],m=t.createEmptyBand(e.pixelType,p),f=t.createEmptyBand(e.pixelType,p);let g=0;for(let t=0;t<c;t++)for(let e=0;e<l;e++)\"vector-uv\"===i?([m[g],f[g]]=h([u[g],x[g]],r),m[g]*=a):([m[g],f[g]]=s([u[g],x[g]],r),m[g]*=a,f[g]*=a),g++;const d=new t({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:[m,f]});return d.updateStatistics(),d}function c(e,t,i=1){if(1===i||!n(e))return e;const r=e.clone(),{pixels:a,width:o,height:h}=r,s=a[0],l=a[1];let c=0;for(let n=0;n<h;n++)for(let e=0;e<o;e++)\"vector-uv\"===t?(s[c]*=i,l[c]*=i):s[c]*=i,c++;return r.updateStatistics(),r}function p(t,i,n,r,a){if(!e(a)||!a.spatialReference.equals(t.spatialReference))return{extent:t,width:i,height:n};const o=a.xmin,h=a.ymax;r=Math.max(r||0,30);const s=Math.ceil(i*(1/r)),l=Math.ceil(n*(1/r)),c=((t.xmax-t.xmin)/s+(t.ymax-t.ymin)/l)/2;return t.xmin=o+Math.floor((t.xmin-o)/c)*c,t.xmax=o+Math.ceil((t.xmax-o)/c)*c,t.ymin=h+Math.floor((t.ymin-h)/c)*c,t.ymax=h+Math.ceil((t.ymax-h)/c)*c,{extent:t,width:Math.round(t.width/c),height:Math.round(t.height/c)}}r.set(\"meter-per-second\",1),r.set(\"kilometer-per-hour\",.277778),r.set(\"knots\",.514444),r.set(\"feet-per-second\",.3048),r.set(\"mile-per-hour\",.44704);export{l as convertVectorFieldData,c as convertVectorFieldUnit,a as getUnitConversionFactor,n as isValidPixelBlock,p as snapImageToSymbolTile};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import e from\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import{enumeration as i}from\"../../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import{debounce as a,isAbortError as o,after as p}from\"../../../../core/promiseUtils.js\";import n from\"../../../../core/Accessor.js\";import c from\"../../../../geometry/Extent.js\";import{createScreenPoint as h}from\"../../../../core/screenUtils.js\";import l from\"../../../../request.js\";import u from\"../../../../Graphic.js\";import{snapImageToSymbolTile as m}from\"../../../../layers/support/rasterFunctions/vectorFieldUtils.js\";import d from\"../../../../support/GraphicsCollection.js\";import{projectExtent as y}from\"../../../../layers/support/rasterFunctions/rasterProjectionHelper.js\";import{Container as g}from\"../../engine/Container.js\";import x from\"../graphics/GraphicsView2D.js\";import w from\"../graphics/GraphicContainer.js\";const f=e.getLogger(\"esri.views.2d.layers.imagery.ImageryGraphicsView2D\");let j=class extends n{constructor(){super(...arguments),this.attached=!1,this.container=new g,this.updateRequested=!1,this._graphicsView=null,this._projectFullExtentPromise=null,this.type=\"Graphics\",this._graphics=new d,this._updateGraphics=a((async(t,e)=>{if(!t.stationary)return;const r=t.state,i=new c({xmin:r.extent.xmin,ymin:r.extent.ymin,xmax:r.extent.xmax,ymax:r.extent.ymax,spatialReference:r.spatialReference}),s=t.state.size[0],a=t.state.size[1],o={};o.timeExtent=this.timeExtent,o.requestAsImageElement=!1,o.signal=e,null==this._projectFullExtentPromise&&(this._projectFullExtentPromise=this._getProjectedFullExtent(i.spatialReference));const n=\"vector-field\"===this.layer.renderer.type?this.layer.renderer.symbolTileSize:50,h=await this._projectFullExtentPromise,l=m(i,s,a,n,h),u=await this.layer.fetchImage(l.extent,l.width,l.height,o),d=this.layer.renderer;if(\"vector-field\"===d.type){this._pixelData={extent:l.extent,pixelBlock:u.pixelData.pixelBlock};const e=await d.getGraphicsFromPixelData(u.pixelData,\"vector-uv\"===this.layer.rasterInfo.dataType);this._graphicsView.update(t),await p(0).then((()=>{this._graphics.set(\"items\",e)}))}}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(t){this._updateGraphics(t).catch((t=>{o(t)||f.error(t)}))}hitTest(t,e){const r=this.view.toMap(h(t,e));return Promise.resolve(new u({attributes:{},geometry:r,layer:this.layer}))}attach(){this._graphicsView=new x({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new w(this.view.featuresTilingScheme)}),this.attached=!0}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}moveStart(){}viewChange(){}moveEnd(){}install(t){this.container.addChild(this._graphicsView.container),t.addChild(this.container)}uninstall(t){this.container.removeChild(this._graphicsView.container),t.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}async _getProjectedFullExtent(t){try{return await y(this.layer.fullExtent,t)}catch(e){try{const e=(await l(this.layer.url,{query:{option:\"footprints\",outSR:t.wkid||JSON.stringify(t.toJSON()),f:\"json\"}})).data.featureCollection.layers[0].layerDefinition.extent;return e?c.fromJSON(e):null}catch{return null}}}};t([r()],j.prototype,\"attached\",void 0),t([r()],j.prototype,\"container\",void 0),t([r()],j.prototype,\"layer\",void 0),t([r()],j.prototype,\"timeExtent\",void 0),t([r()],j.prototype,\"view\",void 0),t([r()],j.prototype,\"updateRequested\",void 0),t([r()],j.prototype,\"updating\",null),t([i({graphics:\"Graphics\"})],j.prototype,\"type\",void 0),j=t([s(\"esri.views.2d.layers.imagery.ImageryGraphicsView2D\")],j);var v=j;export default v;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{init as i,watch as r}from\"../../../core/watchUtils.js\";import{RefreshableLayerView as a}from\"../../layers/RefreshableLayerView.js\";import o from\"../../layers/LayerView.js\";import{ImageryLayerView as h}from\"../../layers/ImageryLayerView.js\";import{LayerView2DMixin as n}from\"./LayerView2D.js\";import l from\"./imagery/ImageryGraphicsView2D.js\";import u from\"./imagery/ImageryView2D.js\";let p=class extends(h(a(n(o)))){constructor(){super(...arguments),this._exportImageVersion=-1}initialize(){this.handles.add(i(this,[\"layer.blendMode\"],(e=>{this.subview&&(this.subview.container.blendMode=e)}),!0))}get pixelData(){return this.updating?null:this.subview.getPixelData()}get updating(){return!(this.subview&&!this.subview.updating)}hitTest(e,t){return this.suspended||!this.subview?Promise.resolve(null):this.subview.hitTest(e,t)}update(e){var t;null==(t=this.subview)||t.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([i(this,\"layer.exportImageServiceParameters.version\",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch(\"timeExtent\",(()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()})),this.layer.on(\"redraw\",(()=>this.subview.redraw())),r(this.layer,\"renderer\",(()=>this._setSubView()))],\"imagerylayerview-update\")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove(\"imagerylayerview-update\"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||!this.suspended&&this.subview.isUpdating()}_setSubView(){var e;let t=\"Imagery\";var s,i;(\"vector-field\"===(null==(e=this.layer.renderer)?void 0:e.type)&&\"lerc\"===this.layer.format&&(t=\"Graphics\"),this.subview&&this.subview.type===t)||(null==(s=this.subview)||s.uninstall(this.container),null==(i=this.subview)||i.destroy(),this.subview=\"Imagery\"===t?new u({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new l({layer:this.layer,view:this.view,timeExtent:this.timeExtent}),this.subview.attach(),this.subview.install(this.container),this.subview.container.blendMode=this.layer.blendMode);this.requestUpdate()}};e([t()],p.prototype,\"pixelData\",null),e([t({readOnly:!0})],p.prototype,\"updating\",null),e([t()],p.prototype,\"subview\",void 0),p=e([s(\"esri.views.2d.layers.ImageryLayerView2D\")],p);var d=p;export default d;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l,hasField as t}from\"../../../layers/support/fieldUtils.js\";async function i(i,d=i.popupTemplate){if(!e(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes(\"*\"))return[\"*\"];const r=s?await p(i):[],m=l(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&t(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&t(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&t(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,i as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import t from\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import{enumeration as i}from\"../../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import{isAbortError as o}from\"../../../../core/promiseUtils.js\";import a from\"../../../../core/Accessor.js\";import{createScreenPoint as n}from\"../../../../core/screenUtils.js\";import p from\"../../../../Graphic.js\";import{mosaicPixelData as l}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import{Container as c}from\"../../engine/Container.js\";import h from\"../../engine/ImageryBitmapSource.js\";import{BitmapContainer as m}from\"../../engine/BitmapContainer.js\";import d from\"../support/ExportStrategy.js\";const u=t.getLogger(\"esri.views.2d.layers.imagery.ImageryView2D\");let g=class extends a{constructor(){super(...arguments),this.attached=!1,this.container=new c,this.updateRequested=!1,this.type=\"Imagery\",this._bitmapView=null}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{o(e)||u.error(e)}))}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e,t){const r=this.view.toMap(n(e,t));return Promise.resolve(new p({attributes:{},geometry:r,layer:this.layer}))}attach(){const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,r=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new m,this.strategy=new d({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:r,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()}),this.attached=!0}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports((e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then((t=>{const r=e.source;r.pixelBlock=t.pixelBlock,r.filter=e=>this.layer.applyFilter(e),this.container.requestRender()}))}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.container.children;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,r=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),i=l(r,t);return i?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}_fetchImage(e,t,r,i){return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((t=>{const r=new h(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=e=>this.layer.applyFilter(e),r}))))}};e([r()],g.prototype,\"attached\",void 0),e([r()],g.prototype,\"container\",void 0),e([r()],g.prototype,\"layer\",void 0),e([r()],g.prototype,\"strategy\",void 0),e([r()],g.prototype,\"timeExtent\",void 0),e([r()],g.prototype,\"view\",void 0),e([r()],g.prototype,\"updateRequested\",void 0),e([r()],g.prototype,\"updating\",null),e([i({imagery:\"Imagery\"})],g.prototype,\"type\",void 0),g=e([s(\"esri.views.2d.layers.imagery.ImageryView2D\")],g);var y=g;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import{getInfo as n}from\"../../../geometry/support/spatialReferenceUtils.js\";import{project as t}from\"../../../geometry/support/webMercatorUtils.js\";import o from\"../../../geometry/Point.js\";import i from\"../../../geometry/Extent.js\";import\"../../../geometry.js\";import{getMetersPerUnitForSR as r}from\"../../../core/unitUtils.js\";import{isLoaded as a,isSupported as s,load as l,getTransformation as c,project as x}from\"../../../geometry/projection.js\";const u=5e-4,m=function(e,n){const t=(e.isWGS84||e.isWebMercator)&&(n.isWGS84||n.isWebMercator);return!(e.equals(n)||t)},p=function(e,n){const t=(e[0]+e[4]+e[4*n.cols]+e[4*n.cols+4])/4,o=(e[1]+e[5]+e[4*n.rows+1]+e[4*n.rows+5])/4;return[Math.abs(t-e[2*n.rows+2]),Math.abs(o-e[2*n.rows+3])]},f=32;async function h(){if(a()||!s())return null;await l()}function y(n,t,o){if(!m(n.spatialReference,t))return null;if(!a())throw new e(\"rasterprojectionhelper-projectResolution\",\"projection engine is not loaded\");return o?c(t,n.spatialReference,n):c(n.spatialReference,t,n)}function M(n,o,r,s=null){if(n.spatialReference.equals(o))return n;const l=m(n.spatialReference,o);if(l&&!a())throw new e(\"rasterprojectionhelper-projectResolution\",\"projection engine is not loaded\");const c=r.center,u=new i({xmin:c.x-n.x/2,xmax:c.x+n.x/2,ymin:c.y-n.y/2,ymax:c.y+n.y/2,spatialReference:n.spatialReference}),p=l?x(u,o,s):t(u,o);if(null==p)return null;return{x:p.xmax-p.xmin,y:p.ymax-p.ymin}}function w(e,n=.01){return r(e)?n/r(e):0}function d(o,i,r=null,s=!0){const l=o.spatialReference;if(l.equals(i))return o;const c=m(l,i);if(c&&!a())throw new e(\"rasterprojectionhelper-projectResolution\",\"projection engine is not loaded\");const p=c?x(o,i,r):t(o,i);if(p&&s&&i.isGeographic){var f,h;const[e,t]=l.isWebMercator?n(l).origin:null!=(f=null==(h=n(l))?void 0:h.valid)?f:[],i=w(l);i&&null!=e&&null!=t&&(Math.abs(o.x-e)<i&&Math.abs(180-p.x)<u?p.x-=360:Math.abs(o.x-t)<i&&Math.abs(180+p.x)<u&&(p.x+=360))}return p}function g(i,r,s=null,l=!0){var c,p,f,h;const y=i.spatialReference;if(y.equals(r))return i;const M=m(y,r);if(M&&!a())throw new e(\"rasterprojectionhelper-projectExtent\",\"projection engine is not loaded\");const g=M?x(i,r,s):t(i,r);let[R,j]=null!=(c=null==(p=n(y))?void 0:p.origin)?c:[];if(g&&l&&y.isWebMercator&&r.isGeographic&&null!=R&&null!=j){const e=.001,n=1e3;if(Math.abs(i.xmin-R)<e&&Math.abs(j-i.xmax)>n&&Math.abs(180-g.xmax)<u){g.xmin=-180;const e=[];e.push(new o(i.xmax,i.ymin,y)),e.push(new o(i.xmax,(i.ymin+i.ymax)/2,y)),e.push(new o(i.xmax,i.ymax,y));const n=e.map((e=>d(e,r,s))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmax=Math.max.apply(null,n)}if(Math.abs(i.xmax-j)<e&&Math.abs(R-i.xmin)>n&&Math.abs(180+g.xmin)<u){g.xmax=180;const e=[];e.push(new o(i.xmin,i.ymin,y)),e.push(new o(i.xmin,(i.ymin+i.ymax)/2,y)),e.push(new o(i.xmin,i.ymax,y));const n=e.map((e=>d(e,r,s))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));g.xmin=Math.min.apply(null,n)}}[R,j]=r.isWebMercator?n(r).origin:null!=(f=null==(h=n(r))?void 0:h.valid)?f:[];const b=w(r);return b&&null!=R&&null!=j&&(Math.abs(g.xmin-R)<b&&(g.xmin=R),Math.abs(g.xmax-j)<b&&(g.xmax=j)),g}function R(t,i,r,s=null,l=null,c=!1,x=[f,f]){var u,h;if(m(t.spatialReference,i.spatialReference)&&!a())throw new e(\"rasterprojectionhelper-projectResolution\",\"projection engine is not loaded\");if(!(t&&i&&r))return null;const{xmin:y,ymin:M,xmax:w,ymax:g}=t,R=t.spatialReference,j=i.spatialReference,[b,v]=null!=(u=null==(h=n(R))?void 0:h.valid)?u:[],N={x:x[0]*r.x,y:x[1]*r.y},S={cols:Math.ceil((w-y)/N.x-.1)+1,rows:Math.ceil((g-M)/N.y-.1)+1},z=N.x,W=N.y,G=[];let P,L=!1;for(let e=0;e<S.cols;e++){const n=[];for(let t=0;t<S.rows;t++){let r=d(new o({x:y+z*e,y:g-W*t,spatialReference:R}),j,s);l&&(r=l.inverseTransform(r)),n.push(r),e>0&&c&&r&&P[t]&&null!=b&&r.x<P[t].x&&(r.x+=v-b),r?(G.push((r.x-i.xmin)/(i.xmax-i.xmin)),G.push((i.ymax-r.y)/(i.ymax-i.ymin))):(G.push(NaN),G.push(NaN),L=!0)}P=n}const q=p(G,S),A=new Float32Array((S.cols-1)*(S.rows-1)*2*6),E=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),F=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let e=0;e<S.cols-1;e++){for(let n=0;n<S.rows-1;n++){let t=e*S.rows*2+2*n;const o=G[t],i=G[t+1],r=G[t+2],a=G[t+3];t+=2*S.rows;const s=G[t],l=G[t+1],c=G[t+2],x=G[t+3];let u=0,m=12*(n*(S.cols-1)+e);for(let e=0;e<3;e++)A[m++]=E[u++]*o+E[u++]*r+E[u++]*c;u=0;for(let e=0;e<3;e++)A[m++]=E[u++]*i+E[u++]*a+E[u++]*x;u=0;for(let e=0;e<3;e++)A[m++]=F[u++]*o+F[u++]*s+F[u++]*c;u=0;for(let e=0;e<3;e++)A[m++]=F[u++]*i+F[u++]*l+F[u++]*x}if(L)for(let e=0;e<A.length;e++)isNaN(A[e])&&(A[e]=-1)}return{offsets:G,error:q,coefficients:A,spacing:x,size:[S.cols-1,S.rows-1]}}function j(e,n,t){const i=Math.log(e.x/n.pixelSize.x)/Math.LN2,r=Math.log(e.y/n.pixelSize.y)/Math.LN2,a=n.storageInfo.maximumPyramidLevel||0;let s=\"down\"===t?Math.floor(Math.min(i,r)):\"up\"===t?Math.ceil(Math.max(i,r)):Math.round((i+r)/2),l=!1;s<0?s=0:s>a&&(l=s>a+3,s=a);const c=2**s;return{pyramidLevel:s,pyramidResolution:new o({x:c*n.nativePixelSize.x,y:c*n.nativePixelSize.y,spatialReference:n.spatialReference}),excessiveReading:l}}function b(e,n,t=512,i=!0){const{extent:a,spatialReference:s,pixelSize:l}=e,c=M(new o({x:l.x,y:l.y,spatialReference:s}),n,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const x=(c.x+c.y)/2,u=r(n),m=x*u*96*39.37,p=n.isGeographic?512/t*295828763.7958547:512/t*591657527.591555;let f=!1;const h=g(a,n);i&&(n.isGeographic||n.isWebMercator)&&(f=h.xmin*h.xmax<0);let y,w=m;const d=1.001;if(f){w=p;const e=.29858214164761665,n=e*(96*u*39.37);y=M(new o({x:e,y:e,spatialReference:{wkid:3857}}),s,h),y.x*=w/n,y.y*=w/n}else{y={x:l.x,y:l.y};const n=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2);let t=0;for(;w<p*(d/2)&&t<n;)t++,w*=2,y.x*=2,y.y*=2;Math.max(w,p)/Math.min(w,p)<=d&&(w=p)}const R=[w],j=[{x:y.x,y:y.y}],b=70.5310735,v=Math.min(b,m)/d;for(;w>=v;)w/=2,y.x/=2,y.y/=2,R.push(w),j.push({x:y.x,y:y.y});return{projectedPixelSize:c,scales:R,srcResolutions:j,isCustomTilingScheme:!f}}export{b as computeProjectedScales,f as defaultGridSpacing,y as getDefaultDatumTransformationForDataset,R as getProjectionOffsetGrid,h as load,g as projectExtent,d as projectPoint,M as projectResolution,j as snapPyramid};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import p from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import a from\"../../tasks/support/Query.js\";import{getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const n=n=>{let c=class extends n{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:t}=this;if(!e)throw new s(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:t});const{popupEnabled:i}=t,n=u(t,o);if(!i||!r(n))throw new s(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:n});const c=await n.getRequiredFields(),m=new a;m.geometry=e,m.outFields=c,m.outSpatialReference=e.spatialReference;const l=this.view.resolution,y=\"2d\"===this.view.type?new p(l,l,this.view.spatialReference):new p(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:d,showNoDataRecords:w}=n.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},h={returnDomainValues:!0,returnTopmostRaster:d,pixelSize:y,showNoDataRecords:w};return t.queryVisibleRasters(m,h).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],c.prototype,\"layer\",void 0),e([o()],c.prototype,\"suspended\",void 0),e([o(i)],c.prototype,\"timeExtent\",void 0),e([o()],c.prototype,\"view\",void 0),c=e([t(\"esri.views.layers.ImageryLayerView\")],c),c};export default n;export{n as ImageryLayerView};\n"],"sourceRoot":"webpack:///"}