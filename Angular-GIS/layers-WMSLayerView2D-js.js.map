{"version":3,"sources":["./node_modules/@arcgis/core/views/2d/layers/WMSLayerView2D.js","./node_modules/@arcgis/core/views/layers/WMSLayerView.js"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC25B,QAAQ,uDAAC,kDAAkD,oBAAoB,6EAAC,CAAC,6FAAC,CAAC,yEAAC,CAAC,6DAAC,KAAK,aAAa,MAAM,eAAe,MAAM,4FAA4F,sDAAC,0JAA0J,QAAQ,IAAI,UAAU,YAAY,UAAU,mCAAmC,2EAAC,gBAAgB,GAAG,SAAS,MAAM,QAAQ,OAAO,iCAAiC,GAAG,0BAA0B,2EAAC,kEAAkE,mEAAC,EAAE,sNAAsN,qGAAqG,SAAS,8JAA8J,aAAa,cAAc,UAAU,qBAAqB,iCAAiC,MAAM,OAAO,+BAA+B,QAAQ,IAAI,mBAAmB,GAAG,mBAAmB,wBAAwB,MAAM,sCAAsC,mBAAmB,sCAAsC,4DAAC,EAAE,+CAA+C,cAAc,kBAAkB,wEAAwE,OAAO,mCAAmC,kBAAkB,qBAAqB,aAAa,oDAAoD,oBAAoB,oCAAoC,gEAAgE,IAAI,8DAAC,EAAE,6FAAC,mCAAmC,8DAAC,EAAE,6FAAC,qCAAqC,8DAAC,EAAE,6FAAC,4CAA4C,QAAuB,gEAAC,EAAC;;;;;;;;;;;;;ACJt3F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAC0nB,YAAY,sBAAsB,aAAa,+BAA+B,qGAAC,EAAE,iBAAiB,EAAE,UAAU,qEAAqE,yBAAyB,MAAM,kJAAkJ,sBAAsB,MAAM,QAAQ,MAAM,gCAAgC,sDAAC,oEAAoE,QAAQ,GAAG,MAAM,eAAe,GAAG,gCAAgC,sDAAC,kEAAkE,eAAe,GAAG,8CAA8C,iCAAiC,MAAM,kCAAkC,GAAG,wBAAwB,sDAAC,mFAAmF,0BAA0B,EAAE,sCAAsC,mCAAmC,OAAO,8DAAC,EAAE,6FAAC,gDAAgD,8DAAC,EAAE,6FAAC,EAAE,YAAY,0CAA0C,8DAAC,EAAE,6FAAC,gCAAgC,8DAAC,EAAE,6FAAC,CAAC,wGAAC,sCAAsC,8DAAC,EAAE,6FAAC,2CAA0D,gEAAC,EAA2B","file":"layers-WMSLayerView2D-js.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as a}from\"../../../core/promiseUtils.js\";import o from\"../../../geometry/Extent.js\";import{RefreshableLayerView as n}from\"../../layers/RefreshableLayerView.js\";import p from\"../../layers/LayerView.js\";import{WMSLayerView as m}from\"../../layers/WMSLayerView.js\";import{BitmapContainer as h}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as c}from\"./LayerView2D.js\";import d from\"./support/ExportStrategy.js\";const l=t.getLogger(\"esri.views.2d.layers.WMSLayerView2D\");let u=class extends(m(n(c(p)))){initialize(){const{layer:e,view:t}=this;e.supportsSpatialReference(t.spatialReference)||this.addResolvingPromise(Promise.reject(new s(\"layerview:spatial-reference-incompatible\",\"The spatial references supported by this WMS layer are incompatible with the spatial reference of the view\",{layer:e})))}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{a(e)||l.error(e)}))}attach(){const{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:r}=e;this._bitmapContainer=new h,this.container.addChild(this._bitmapContainer),this.strategy=new d({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:r,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch(\"exportImageVersion\",(()=>this.requestUpdate())),\"exportImageVersion\")}detach(){this.handles.remove(\"exportImageVersion\"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t}=this,r=this._bitmapContainer,{x:i,y:s}=e,{spatialReference:a}=t;let n=null,p=0,m=0;if(r.children.some((e=>{const{width:t,height:r,resolution:h,x:c,y:d}=e,l=c+h*t,u=d-h*r;return i>=c&&i<=l&&s<=d&&s>=u&&(n=new o({xmin:c,ymin:u,xmax:l,ymax:d,spatialReference:a}),p=t,m=r,!0)})),!n)return null;const h=n.width/p,c=Math.round((i-n.xmin)/h),d=Math.round((n.ymax-s)/h);return{extent:n,width:p,height:m,x:c,y:d}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp,...i})}};e([r()],u.prototype,\"strategy\",void 0),e([r()],u.prototype,\"updating\",void 0),u=e([i(\"esri.views.2d.layers.WMSLayerView2D\")],u);var y=u;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{combinedViewLayerTimeExtentProperty as s}from\"../../layers/support/commonProperties.js\";import{ExportWMSImageParameters as p}from\"../../layers/support/ExportWMSImageParameters.js\";const i=i=>{let a=class extends i{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}fetchPopupFeatures(e){const{layer:r}=this;if(!e)return Promise.reject(new o(\"wmslayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:r}));const{popupEnabled:t}=r;if(!t)return Promise.reject(new o(\"wmslayerview:fetchPopupFeatures\",\"popupEnabled should be true\",{popupEnabled:t}));const s=this.createFetchPopupFeaturesQuery(e);if(!s)return Promise.resolve([]);const{extent:p,width:i,height:a,x:m,y:n}=s;if(!(p&&i&&a))throw new o(\"wmslayerview:fetchPopupFeatures\",\"WMSLayer does not support fetching features.\",{extent:p,width:i,height:a});const u=r.fetchFeatureInfo(p,i,a,m,n);return Promise.resolve(u?[u]:[])}};return e([r()],a.prototype,\"exportImageParameters\",void 0),e([r({readOnly:!0})],a.prototype,\"exportImageVersion\",null),e([r()],a.prototype,\"layer\",void 0),e([r(s)],a.prototype,\"timeExtent\",void 0),a=e([t(\"esri.layers.mixins.WMSLayerView\")],a),a};export default i;export{i as WMSLayerView};\n"],"sourceRoot":"webpack:///"}